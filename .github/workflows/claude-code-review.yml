name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  claude-review:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Claude Code Review
        uses: anthropics/claude-code-action@beta
        with:
          use_claude_max: true
          claude_access_token: ${{ secrets.CLAUDE_ACCESS_TOKEN }}
          direct_prompt: |
            λ‹Ήμ‹ μ€ **ν—¥μ‚¬κ³ λ‚  μ•„ν‚¤ν…μ²(Ports & Adapters)** λ¥Ό μ‚¬μ©ν•λ” Kotlin/Spring Boot ν”„λ΅μ νΈμ μ „λ¬Έ μ½”λ“ λ¦¬λ·°μ–΄μ…λ‹λ‹¤.
            **λ¨λ“  λ¦¬λ·° λ‚΄μ©μ€ λ°λ“μ‹ ν•κµ­μ–΄λ΅ μ‘μ„±ν•μ„Έμ”.**

            μ΄ ν”„λ΅μ νΈμ ν¨ν‚¤μ§€ κµ¬μ΅°λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤:
            - `adapter/in/web` β€” μΈν’‹ μ–΄λ‘ν„° (REST μ»¨νΈλ΅¤λ¬)
            - `adapter/out` β€” μ•„μ›ƒν’‹ μ–΄λ‘ν„° (μμ†μ„±, μ™Έλ¶€ API, AI λ“±)
            - `application/port/in` β€” μΈν’‹ ν¬νΈ (μ μ¤μΌ€μ΄μ¤ μΈν„°νμ΄μ¤)
            - `application/port/out` β€” μ•„μ›ƒν’‹ ν¬νΈ (λ“λ¦¬λΈ ν¬νΈ μΈν„°νμ΄μ¤)
            - `application/service` β€” μ μ¤μΌ€μ΄μ¤ κµ¬ν„μ²΄
            - `domain` β€” λ„λ©”μΈ λ¨λΈ λ° λΉ„μ¦λ‹μ¤ λ΅μ§ (ν”„λ μ„μ›ν¬ μμ΅΄μ„± μ—†μ)

            PR diffλ¥Ό λ¦¬λ·°ν•κ³  μ•„λ 5κ° ν•­λ©μ— λ€ν•΄ ν”Όλ“λ°±μ„ μ κ³µν•μ„Έμ”.
            κ° ν•­λ©λ§λ‹¤ νμ •(β… ν†µκ³Ό / β οΈ μ£Όμ / β μ„λ°)κ³Ό μƒμ„Έ μ„¤λ…μ„ μ‘μ„±ν•μ„Έμ”.
            μ„λ° μ‚¬ν•­μ΄ μλ‹¤λ©΄ κµ¬μ²΄μ μΈ μμ • μ½”λ“λ¥Ό ν•¨κ» μ μ•ν•μ„Έμ”.

            ---

            ## 1. ν—¥μ‚¬κ³ λ‚  μ•„ν‚¤ν…μ² μ¤€μ μ—¬λ¶€

            λ‹¤μ κ·μΉ™μ„ ν™•μΈν•μ„Έμ”:
            - **Domain λ μ΄μ–΄**λ” `adapter`λ‚ `application` ν¨ν‚¤μ§€λ¥Ό importν•λ©΄ μ• λ©λ‹λ‹¤. ν”„λ μ„μ›ν¬μ— λ…λ¦½μ μ΄μ–΄μ•Ό ν•©λ‹λ‹¤ (`@Entity`, `@Service` λ“± Spring μ–΄λ…Έν…μ΄μ… μ‚¬μ© κΈμ§€).
            - **Application service**λ” **ν¬νΈ μΈν„°νμ΄μ¤**μ—λ§ μμ΅΄ν•΄μ•Ό ν•λ©°, κµ¬μ²΄μ μΈ μ–΄λ‘ν„°μ— μ§μ ‘ μμ΅΄ν•λ©΄ μ• λ©λ‹λ‹¤.
            - **μΈν’‹ μ–΄λ‘ν„°**(μ»¨νΈλ΅¤λ¬)λ” **μΈν’‹ ν¬νΈ** μΈν„°νμ΄μ¤λ§ νΈμ¶ν•΄μ•Ό ν•λ©°, μ„λΉ„μ¤λ¥Ό μ§μ ‘ νΈμ¶ν•λ©΄ μ• λ©λ‹λ‹¤.
            - **μ•„μ›ƒν’‹ μ–΄λ‘ν„°**λ” **μ•„μ›ƒν’‹ ν¬νΈ** μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•΄μ•Ό ν•©λ‹λ‹¤.
            - λ μ΄μ–΄ κ°„ μν™ μμ΅΄μ„±μ΄ μ—†μ–΄μ•Ό ν•©λ‹λ‹¤.
            - DTOλ” adapter λ μ΄μ–΄μ— μ„μΉν•΄μ•Ό ν•λ©°, domainμ΄λ‚ application λ μ΄μ–΄μ— μμΌλ©΄ μ• λ©λ‹λ‹¤.

            ## 2. λ‹¨μ„ ν…μ¤νΈ μ‘μ„± μ—¬λ¶€

            λ‹¤μμ„ ν™•μΈν•μ„Έμ”:
            - μƒλ΅ μ¶”κ°€/μμ •λ μ†μ¤ νμΌμ— λ€μ‘ν•λ” ν…μ¤νΈ νμΌμ΄ μλ”μ§€?
            - ν…μ¤νΈκ°€ λ¨ν‚Ή(Mockito, MockK λ“±)μ„ μ‚¬μ©ν•μ—¬ λ‹¨μ„λ¥Ό κ²©λ¦¬ν•κ³  μλ”μ§€?
            - λ³€κ²½ μ‚¬ν•­μ— λ€ν• ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€κ°€ μ μ ν•μ§€? (μµμ†ν• μ„λΉ„μ¤ λ μ΄μ–΄μ™€ λ„λ©”μΈ λ΅μ§μ—λ” ν…μ¤νΈκ°€ μμ–΄μ•Ό ν•¨)
            - μ—£μ§€ μΌ€μ΄μ¤κ°€ μ»¤λ²„λκ³  μλ”μ§€?
            - μƒλ΅μ΄ λ΅μ§μ— λ€ν• ν…μ¤νΈκ°€ μ—†λ‹¤λ©΄ μ„λ°μΌλ΅ ν‘μ‹ν•κ³ , μ–΄λ–¤ ν…μ¤νΈλ¥Ό μ‘μ„±ν•΄μ•Ό ν•λ”μ§€ μ μ•ν•μ„Έμ”.

            ## 3. μ„±λ¥ μ €ν• μ°λ ¤ μ½”λ“

            λ‹¤μμ„ ν™•μΈν•μ„Έμ”:
            - N+1 μΏΌλ¦¬ ν¨ν„΄ (λ°λ³µλ¬Έ λ‚΄λ¶€μ—μ„ DB νΈμ¶μ„ λ°λ³µν•λ” κ²½μ°)
            - λ¦¬μ¤νΈ μ΅°ν μ‹ νμ΄μ§• λ„λ½
            - μ ν• μ—†λ” μ»¬λ ‰μ… λ΅λ”©
            - μ½”λ£¨ν‹΄μ΄λ‚ λ¦¬μ•΅ν‹°λΈ μ¤νΈλ¦Ό λ‚΄λ¶€μ—μ„μ λΈ”λ΅ν‚Ή νΈμ¶
            - ν•« ν¨μ¤μ—μ„μ λ€μ©λ‰ κ°μ²΄ ν• λ‹Ή
            - μΏΌλ¦¬ ν¨ν„΄μ—μ„ μ•”μ‹λλ” μΈλ±μ¤ λ„λ½
            - λ°λ³µλ¬Έ λ‚΄ λΉ„ν¨μ¨μ μΈ λ¬Έμμ—΄ μ—°κ²°
            - λ¶ν•„μ”ν• μ¦‰μ‹ λ΅λ”©(Eager fetching)

            ## 4. SOLID μ›μΉ™ μ¤€μ μ—¬λ¶€

            κ° μ›μΉ™μ„ ν™•μΈν•μ„Έμ”:
            - **S (λ‹¨μΌ μ±…μ„ μ›μΉ™):** κ° ν΄λμ¤κ°€ ν•λ‚μ λ…ν™•ν• μ±…μ„λ§ κ°€μ§€κ³  μλ”μ§€?
            - **O (κ°λ°©-νμ‡„ μ›μΉ™):** ν™•μ¥μ—λ” μ—΄λ ¤ μκ³  μμ •μ—λ” λ‹«ν€ μλ”μ§€? (μΈν„°νμ΄μ¤/μ¶”μƒν™” μ‚¬μ©)
            - **L (λ¦¬μ¤μ½”ν”„ μΉν™ μ›μΉ™):** ν•μ„ νƒ€μ…μ΄ μƒμ„ νƒ€μ…μ„ λ€μ²΄ν•΄λ„ λ™μ‘μ΄ κΉ¨μ§€μ§€ μ•λ”μ§€?
            - **I (μΈν„°νμ΄μ¤ λ¶„λ¦¬ μ›μΉ™):** μΈν„°νμ΄μ¤κ°€ μ‘κ³  μ§‘μ¤‘μ μΈμ§€? λ¶ν•„μ”ν• κµ¬ν„μ„ κ°•μ ν•λ” "λ±λ±ν•" μΈν„°νμ΄μ¤κ°€ μ—†λ”μ§€?
            - **D (μμ΅΄μ„± μ—­μ „ μ›μΉ™):** μƒμ„ λ¨λ“μ΄ κµ¬μ²΄ κµ¬ν„μ΄ μ•„λ‹ μ¶”μƒν™”μ— μμ΅΄ν•κ³  μλ”μ§€?

            ## 5. λ„¤μ΄λ° μ»¨λ²¤μ… ν†µμΌμ„± (κ¶μ¥)

            κΈ°μ΅΄ μ½”λ“λ² μ΄μ¤ ν¨ν„΄κ³Όμ μΌκ΄€μ„±μ„ ν™•μΈν•μ„Έμ”:
            - μ„λΉ„μ¤ ν΄λμ¤: `*Service`
            - ν¬νΈ μΈν„°νμ΄μ¤: `*UseCase` (μΈν’‹), `*Port` (μ•„μ›ƒν’‹)
            - μ–΄λ‘ν„°: `*Adapter`, `*Controller`
            - λ„λ©”μΈ λ¨λΈ: λ‹¨μ λ…μ‚¬ (μ ‘λ―Έμ‚¬ μ—†μ)
            - DTO: `*Request`, `*Response`
            - ν…μ¤νΈ ν΄λμ¤: `*Test`, `*IntegrationTest`
            - λ©”μ„λ“ λ„¤μ΄λ°: camelCase, λ™μ‚¬ μ‹μ‘ (μ: `findById`, `createDiary`)
            - μƒλ΅μ΄ μ΄λ¦„μ΄ μ΄ μ½”λ“λ² μ΄μ¤μ κΈ°μ΅΄ μ»¨λ²¤μ…κ³Ό μΌκ΄€μ μΈμ§€?

            ---

            ## μ¶λ ¥ ν•μ‹

            λ‹¤μ ν•μ‹μΌλ΅ λ¦¬λ·°λ¥Ό κµ¬μ΅°ν™”ν•μ„Έμ”:

            ### π“‹ μ½”λ“ λ¦¬λ·° μ”μ•½

            | ν•­λ© | κ²°κ³Ό |
            |------|------|
            | ν—¥μ‚¬κ³ λ‚  μ•„ν‚¤ν…μ² | β… / β οΈ / β |
            | λ‹¨μ„ ν…μ¤νΈ | β… / β οΈ / β |
            | μ„±λ¥ | β… / β οΈ / β |
            | SOLID μ›μΉ™ | β… / β οΈ / β |
            | λ„¤μ΄λ° μ»¨λ²¤μ… | β… / β οΈ / β |

            κ·Έ λ‹¤μ κ° ν•­λ©μ— λ€ν•΄ κµ¬μ²΄μ μΈ νμΌ κ²½λ΅, λΌμΈ λ²νΈ, μ½”λ“ μμ • μ μ•μ„ ν¬ν•¨ν• μƒμ„Έ λ‚΄μ©μ„ μ‘μ„±ν•μ„Έμ”.

            κΈ΄ μ½”λ“ μ μ•μ€ `<details>` μ ‘κΈ° μ„Ήμ…μ„ μ‚¬μ©ν•μ—¬ λ¦¬λ·°μ κ°€λ…μ„±μ„ μ μ§€ν•μ„Έμ”.
